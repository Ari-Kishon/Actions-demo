name: Send out a rescue expedition
on:
  workflow_dispatch:
    inputs:
      explorer:
        default: ðŸ§‘â€ðŸš€
        description: which explorer to send
        type: string
      ship:
        default: ðŸš€
        description: which vessel to send the explorer in
        type: choice
        options:
          - ðŸš€
          - ðŸ‰
          - ðŸ›¥ï¸
          - â˜ï¸
  pull_request:
jobs:
  dispatch-explorer:
    name: Disptach the explorer
    runs-on: ubuntu-latest
    outputs:
      explorer: ${{ steps.get-explorer.outputs.explorer }}
      ship: ${{ steps.get-ship.outputs.ship }}
    steps:
      - id: get-explorer
        name: retrieve out daring rescuer
        run: echo "explorer=${{ inputs.explorer || 'ðŸ§‘â€ðŸš€'}}" >> $GITHUB_OUTPUT
      - id: get-ship
        name: retrieve our daring rescuer
        run: echo "ship=${{ inputs.ship || 'ðŸš€'}}" >> $GITHUB_OUTPUT

  perform-rescue-operation:
    needs: [dispatch-explorer]
    strategy:
      max-parallel: 1
      matrix:
        mission:
          [
            { planet: ðŸª, target: The scientist ðŸ§‘â€ðŸ”¬, platform: ubuntu-latest },
            { planet: ðŸŒš, target: The doctor ðŸ‘¨â€âš•ï¸, platform: macos-latest },
            { planet: ðŸŒž, target: The pilot ðŸ§‘â€âœˆï¸, platform: windows-latest },
          ]
    name: Land on the planet ${{matrix.mission.planet}}
    runs-on: ${{ matrix.mission.platform }}
    timeout-minutes: 25
    steps:
      - name: ${{ needs.dispatch-explorer.outputs.ship }} âž¡ï¸ ${{ matrix.mission.planet }}
        run: echo "${{ needs.dispatch-explorer.outputs.ship }} left for ${{ matrix.mission.planet }}"

      - name: ${{ needs.dispatch-explorer.outputs.explorer }} â¬‡ï¸ ${{ matrix.mission.planet }}
        run: echo "${{ needs.dispatch-explorer.outputs.explorer }} has landed on ${{ matrix.mission.planet }}"

      - name: ${{ needs.dispatch-explorer.outputs.explorer }} ðŸ‘€ ${{ matrix.mission.target }}
        run: echo "${{ needs.dispatch-explorer.outputs.explorer }} has found ${{ matrix.mission.target }}"

  announce-succesful-resuce:
    needs: [perform-rescue-operation]
    name: Annouce succeful operation
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "
          ### All rescue opertations were a ${{ job.status }}

          ---

          hooray! :)
          " >> $GITHUB_STEP_SUMMARY
